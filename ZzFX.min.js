// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.samples=0,this.volume=.3,this.sampleRate=44100}Play(t){if(!t||"object"!=typeof t){var e=this.BuildSound();t=this.BuildSound(...arguments);for(const a in t)void 0===t[a]&&(t[a]=e[a])}return e=this.SoundToArray(t),e=this.BuildSamples(...e,this.volume),this.PlaySamples(e)}PlaySamples(t){const e=this.x.createBuffer(1,t.length,this.sampleRate),a=this.x.createBufferSource();return e.getChannelData(0).set(t),a.buffer=e,a.connect(this.x.destination),a.start(),this.samples=t,a}BuildSamples(t,e,a,s,n,o,r,i,u,h,l,d,p,c,m,f,M,S=1){const C=2*Math.PI,x=this.sampleRate,B=u*=500*C/x**2,v=(0<m?1:-1)*C/4;e=a*=(1+e*(2*Math.random()-1))*C/x,s=50+s*x|0,n=n*x|0,o=o*x|0,M=M*x|0,h*=500*C/x**3,m*=C/x,l*=C/x,d*=x,p*=x;const y=Math.max(1,Math.min(s+n+o+M,10*x));let F=[],Z=0,b=0,A=0,T=1,w=0,P=0,J=0,R=.5;for(;A<y;F[A++]=J)++P>100*f&&(P=0,J=Z*a*Math.sin(b*m-v),4<r?J=0<(J/C%1+1)%1-(R+=100*i/x)%1?1:-1:J=(0<(J=r?1<r?2<r?3<r?0<Math.sin((J%C)**3)?1:-1:Math.max(Math.min(Math.tan(J),1),-1):1-(2*J/C%2+2)%2:1-4*Math.abs(Math.round(J/C)-J/C):Math.sin(J))?1:-1)*Math.abs(J)**i,J*=t*S*(A<s?A/s:A<s+n?1:A<y-M?1-(A-s-n)/o:0),J=M?J/2+(M>A?0:(A<y-M?1:(A-y)/M)*F[A-M]/2):J),Z+=1+c*(2*Math.random()-1),b+=1+c*(2*Math.random()-1),a+=u+=h,T&&++T>d&&(e+=l,a+=l,T=0),p&&++w>p&&(a=e,u=B,w=1,T=T||1);return F}BuildRandomSound(){function t(){return Math.random()}const e=(t,e=1)=>(t=t.toFixed(e),parseFloat(t)?t:"0"),a=this.BuildSound(1,.05,2e3*t()**2|0,e(.01+t()**3,2),e(t()**3,2),e(.01+t()**3,2),6*t()|0,.2>t()?1:e(2*t()),.5>t()?0:e(100*t()**3*(.5>t()?-1:1)),.5>t()?0:e(100*t()**3*(.5>t()?-1:1)),0,0,0,.5>t()?0:e(3*t()**3),.5>t()?0:e(1e3*t()**4),.5>t()?0:e(5*t()**3,2),.5>t()?0:e(.5*t()**3,2));5==a.shape?a.shapeCurve=e(100*t()**3,2):.1>t()&&(a.shapeCurve=e(100*t()**3,0)),10<=a.shapeCurve&&(a.shapeCurve=parseInt(a.shapeCurve));const s=parseFloat(a.attack)+parseFloat(a.sustain)+parseFloat(a.release);return.5>t()&&(a.modulation*=-1),.3>t()&&(a.pitchJump=1e3*t()**2*(.5>t()?-1:1)|0,a.pitchJumpTime=e(t()*s,2)),.3>t()&&(a.repeatTime=e(t()*s,2)),a}BuildSound(t=1,e=.05,a=220,s=0,n=0,o=.1,r=0,i=1,u=0,h=0,l=0,d=0,p=0,c=0,m=0,f=0,M=0){return{volume:t,randomness:e,frequency:a,attack:s,sustain:n,release:o,shape:r,shapeCurve:i,slide:u,deltaSlide:h,pitchJump:l,pitchJumpTime:d,repeatTime:p,noise:c,modulation:m,bitCrush:f,delay:M}}GetNote(t,e){return t*2**(e/12)}SoundToArray(t){const e=this.BuildSound(),a=[];for(const s in e)a.push(t[s]);return a}CreateAudioContext(){const t=new(window.AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((e=t.a())=>(e.start=e.start||(e=>t.noteOn(e)),e.stop=e.stop||(e=>t.noteOff(e)),e)),t}}const ZZFX=new _ZZFX;function zzfx(){ZZFX.Play(...arguments)}