// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.samples=0,this.volume=.3,this.sampleRate=44100}Play(t){if(!t||"object"!=typeof t){var a=this.BuildSound();t=this.BuildSound(...arguments);for(const e in t)void 0===t[e]&&(t[e]=a[e])}return a=this.SoundToArray(t),a=this.BuildSamples(...a,this.volume),this.PlaySamples(a)}PlaySamples(t){const a=this.x.createBuffer(1,t.length,this.sampleRate),e=this.x.createBufferSource();return a.getChannelData(0).set(t),e.buffer=a,e.connect(this.x.destination),e.start(),this.samples=t,e}BuildSamples(t,a,e,o,n,r,s,h,d,i,u,m,l,M,c,p,f,S,B=1){const y=2*Math.PI;var x=this.sampleRate;const v=d*=500*y/x**2;a=e*=(1+a*(2*Math.random()-1))*y/x,o=50+o*x|0,n=n*x|0,r=r*x|0,S=S*x/1e3|0,i*=500*y/x**3,c*=y/x,u*=y/x,m=m*x|0,l=l*x|0,p*=y,x=Math.max(1,Math.min(o+n+r,10*x));let b,w,F=[],g=0,A=0,C=0,R=1,Z=0;for(;C<x;F[C++]=b)b=g*e*Math.cos(A*c+p),b=s?1<s?2<s?3<s?Math.sign(Math.cos((b%y)**3)):Math.max(Math.min(Math.tan(b),1),-1):2*b/y%2+(0>b?1:-1):1-4*Math.abs(Math.round(b/y)-b/y):Math.cos(b),b=Math.sign(b)*Math.abs(b)**h,b*=(w=C<o?C/o:C<o+n?1:1-(C-o-n)/r)*t*B,b=f?(b/f*9|0)*f/9:b,b=S?b/2+(S>C?0:(C<o+n?1:w)*F[C-S]/2):b,g+=1+M*(2*Math.random()-1),A+=1+M*(2*Math.random()-1),e+=d+=i,R&&++R>m&&(a+=u,e+=u,R=0),l&&++Z>l&&(e=a,d=v,Z=1,R=R||1);return F}BuildRandomSound(){const t=(t,a=1)=>(t=t.toFixed(a),parseFloat(t)?t:"0"),a=this.BuildSound(1,.05,2e3*Math.random()**2|0,t(.01+Math.random()**2,2),t(Math.random()**2,2),t(.01+Math.random()**2,2),5*Math.random()|0,.2>Math.random()?1:t(2*Math.random()),.5>Math.random()?0:t(10*Math.random()**3*(.5>Math.random()?-1:1)),.5>Math.random()?0:t(10*Math.random()**3*(.5>Math.random()?-1:1)),0,0,0,.5>Math.random()?0:t(5*Math.random()**3),.8>Math.random()?0:t(99*Math.random()**4),0,.5>Math.random()?0:t(Math.random()**2,2),.5>Math.random()?0:t(3*Math.random()**2,2)),e=parseFloat(a.attack)+parseFloat(a.sustain)+parseFloat(a.release);return parseFloat(a.smodulation)&&(a.smodPhase=t(Math.random(),2)),.3>Math.random()&&(a.pitchJump=1e3*Math.random()**2*(.5>Math.random()?-1:1)|0,a.pitchJumpTime=t(Math.random()*e,2)),.3>Math.random()&&(a.repeatTime=t(Math.random()*e,2)),a}BuildSound(t=1,a=.05,e=220,o=.1,n=.1,r=.2,s=0,h=1,d=0,i=0,u=0,m=0,l=0,M=0,c=0,p=0,f=0,S=0){return{volume:t,randomness:a,frequency:e,attack:o,sustain:n,release:r,shape:s,shapeCurve:h,slide:d,deltaSlide:i,pitchJump:u,pitchJumpTime:m,repeatTime:l,noise:M,modulation:c,modPhase:p,bitCrush:f,delay:S}}GetNote(t,a){return t*2**(a/12)}SoundToArray(t){const a=this.BuildSound(),e=[];for(const o in a)e.push(t[o]);return e}CreateAudioContext(){const t=new(window.AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((a=t.a())=>(a.start=a.start||(a=>t.noteOn(a)),a.stop=a.stop||(a=>t.noteOff(a)),a)),t}BuildWaveDataUrl(t){var a=(t=this.BuildSamples(...this.SoundToArray(t))).length;const e=new Int16Array(a+23);var o=this.sampleRate;for(e[0]=18770,e[1]=17990,e[2]=2*a+15&65535,e[3]=(2*a+15&4294901760)>>16,e[4]=16727,e[5]=17750,e[6]=28006,e[7]=8308,e[8]=18,e[9]=0,e[10]=1,e[11]=1,e[12]=65535&o,e[13]=(4294901760&o)>>16,e[14]=2*o&65535,e[15]=(2*o&4294901760)>>16,e[16]=4,e[17]=16,e[18]=0,e[19]=24932,e[20]=24948,e[21]=2*a&65535,e[22]=(2*a&4294901760)>>16,o=0;o<a;o++){const a=t[o];e[o+23]=1<=a?32767:Math.round(32768*a)}let n=0,r=0;for(t=(t=>{n=r+t>=e.length,t=new Int16Array(n?e.length-r:t);for(let a=0;a<t.length;a++)t[a]=e[a+r];return r+=t.length,t.buffer}),a=[];!n;)a.push(t(1e3));return(webkitURL||URL).createObjectURL(new Blob(a,{type:"audio/wav"}))}}const ZZFX=new _ZZFX;function zzfx(){ZZFX.Play(...arguments)}