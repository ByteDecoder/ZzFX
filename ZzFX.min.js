// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.samples=0,this.volume=.3,this.sampleRate=44100}Play(t){if(!t||"object"!=typeof t){var e=this.BuildSound();t=this.BuildSound(...arguments);for(const a in t)void 0===t[a]&&(t[a]=e[a])}return e=this.SoundToArray(t),e=this.BuildSamples(...e,this.volume),this.PlaySamples(e)}PlaySamples(t){const e=this.x.createBuffer(1,t.length,this.sampleRate),a=this.x.createBufferSource();return e.getChannelData(0).set(t),a.buffer=e,a.connect(this.x.destination),a.start(),this.samples=t,a}BuildSamples(t,e,a,s,n,o,r,i,u,h,l,d,c,m,p,f,M,S,B=1){const y=2*Math.PI;var x=this.sampleRate;const v=u*=500*y/x**2;e=a*=(1+e*(2*Math.random()-1))*y/x,s=50+s*x|0,n=n*x|0,o=o*x|0,S=S*x/1e3|0,h*=500*y/x**3,p*=y/x,l*=y/x,d=d*x|0,c=c*x|0,f*=y,x=Math.max(1,Math.min(s+n+o,10*x));let b,w,F=[],g=0,A=0,C=0,R=1,Z=0;for(;C<x;F[C++]=b)b=g*a*Math.cos(A*p+f),b=r?1<r?2<r?3<r?Math.sign(Math.cos((b%y)**3)):Math.max(Math.min(Math.tan(b),1),-1):1-2*b/y%2:1-4*Math.abs(Math.round(b/y)-b/y):Math.cos(b),b=Math.sign(b)*Math.abs(b)**i,b*=(w=C<s?C/s:C<s+n?1:1-(C-s-n)/o)*t*B,b=M?(b/M*9|0)*M/9:b,b=S?b/2+(S>C?0:(C<s+n?1:w)*F[C-S]/2):b,g+=1+m*(2*Math.random()-1),A+=1+m*(2*Math.random()-1),a+=u+=h,R&&++R>d&&(e+=l,a+=l,R=0),c&&++Z>c&&(a=e,u=v,Z=1,R=R||1);return F}BuildRandomSound(){function t(){return Math.random()}const e=(t,e=1)=>(t=t.toFixed(e),parseFloat(t)?t:"0"),a=this.BuildSound(1,.05,2e3*t()**2|0,e(.01+t()**2,2),e(t()**2,2),e(.01+t()**2,2),5*t()|0,.2>t()?1:e(2*t()),.5>t()?0:e(10*t()**3*(.5>t()?-1:1)),.5>t()?0:e(10*t()**3*(.5>t()?-1:1)),0,0,0,.5>t()?0:e(5*t()**3),.8>t()?0:e(99*t()**4),0,.5>t()?0:e(t()**2,2),.5>t()?0:e(3*t()**2,2)),s=parseFloat(a.attack)+parseFloat(a.sustain)+parseFloat(a.release);return parseFloat(a.smodulation)&&(a.smodPhase=e(t(),2)),.3>t()&&(a.pitchJump=1e3*t()**2*(.5>t()?-1:1)|0,a.pitchJumpTime=e(t()*s,2)),.3>t()&&(a.repeatTime=e(t()*s,2)),a}BuildSound(t=1,e=.05,a=220,s=.1,n=.1,o=.2,r=0,i=1,u=0,h=0,l=0,d=0,c=0,m=0,p=0,f=0,M=0,S=0){return{volume:t,randomness:e,frequency:a,attack:s,sustain:n,release:o,shape:r,shapeCurve:i,slide:u,deltaSlide:h,pitchJump:l,pitchJumpTime:d,repeatTime:c,noise:m,modulation:p,modPhase:f,bitCrush:M,delay:S}}GetNote(t,e){return t*2**(e/12)}SoundToArray(t){const e=this.BuildSound(),a=[];for(const s in e)a.push(t[s]);return a}CreateAudioContext(){const t=new(window.AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((e=t.a())=>(e.start=e.start||(e=>t.noteOn(e)),e.stop=e.stop||(e=>t.noteOff(e)),e)),t}BuildWaveDataUrl(t){var e=(t=this.BuildSamples(...this.SoundToArray(t))).length;const a=new Int16Array(e+23);var s=this.sampleRate;for(a[0]=18770,a[1]=17990,a[2]=2*e+15&65535,a[3]=(2*e+15&4294901760)>>16,a[4]=16727,a[5]=17750,a[6]=28006,a[7]=8308,a[8]=18,a[9]=0,a[10]=1,a[11]=1,a[12]=65535&s,a[13]=(4294901760&s)>>16,a[14]=2*s&65535,a[15]=(2*s&4294901760)>>16,a[16]=4,a[17]=16,a[18]=0,a[19]=24932,a[20]=24948,a[21]=2*e&65535,a[22]=(2*e&4294901760)>>16,s=0;s<e;s++){const e=t[s];a[s+23]=1<=e?32767:Math.round(32768*e)}let n=0,o=0;for(t=(t=>{n=o+t>=a.length,t=new Int16Array(n?a.length-o:t);for(let e=0;e<t.length;e++)t[e]=a[e+o];return o+=t.length,t.buffer}),e=[];!n;)e.push(t(1e3));return(webkitURL||URL).createObjectURL(new Blob(e,{type:"audio/wav"}))}}const ZZFX=new _ZZFX;function zzfx(){ZZFX.Play(...arguments)}