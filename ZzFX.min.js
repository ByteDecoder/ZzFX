// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
class _ZZFX{constructor(){this.x=this.CreateAudioContext();this.samples=0;this.volume=.3;this.sampleRate=44100}Play(a){if(!a||"object"!=typeof a){var b=this.BuildSound();a=this.BuildSound(...arguments);for(const c in a)"undefined"==typeof a[c]&&(a[c]=b[c])}b=this.SoundToArray(a);b=this.BuildSamples(...b,this.volume);return this.PlaySamples(b)}PlaySamples(a){const b=this.x.createBuffer(1,a.length,this.sampleRate),c=this.x.createBufferSource();b.getChannelData(0).set(a);c.buffer=b;c.connect(this.x.destination);
c.start();this.samples=a;return c}BuildSamples(a,b,c,f,m,n,l,v,p,w,q,x,r,y,t,A,g,G=1){const h=2*Math.PI,e=this.sampleRate,H=p*=500*h/e**2,I=(0<t?1:-1)*h/4;b=c*=(1+b*(2*Math.random()-1))*h/e;f=50+f*e|0;m=m*e|0;n=n*e|0;g=g*e|0;w*=500*h/e**3;t*=h/e;q*=h/e;x*=e;r*=e;const z=Math.max(1,Math.min(f+m+n+g,10*e));let B=[],C=0,D=0,k=0,u=1,E=0,F=0,d=0,J=.5;for(;k<z;B[k++]=d)++F>100*A&&(F=0,d=C*c*Math.sin(D*t-I),d=l?1<l?2<l?3<l?4<l?0<(d/h%1+1)%1-(J+=1e3*v/e)%1?1:-1:Math.sin((d%h)**3):Math.max(Math.min(Math.tan(d),
1),-1):1-(2*d/h%2+2)%2:1-4*Math.abs(Math.round(d/h)-d/h):Math.sin(d),5>l&&(d=(0<d?1:-1)*Math.abs(d)**v),d*=a*G*(k<f?k/f:k<f+m?1:k<z-g?1-(k-f-m)/n:0),d=g?d/2+(g>k?0:(k<z-g?1:(k-z)/g)*B[k-g]/2):d),C+=1+y*(2*Math.random()-1),D+=1+y*(2*Math.random()-1),c+=p+=w,u&&++u>x&&(b+=q,c+=q,u=0),r&&++E>r&&(c=b,p=H,E=1,u=u||1);return B}BuildRandomSound(){function a(){return Math.random()}const b=this.BuildSound(1,.05,2E3*a()**2|0,.01+a()**3,a()**3,.01+a()**3,6*a()|0,.2>a()?1:2*a(),.5>a()?0:100*a()**3*(.5>a()?-1:
1),.5>a()?0:100*a()**3*(.5>a()?-1:1),0,0,0,.5>a()?0:3*a()**3,.5>a()?0:1E3*a()**4,.5>a()?0:5*a()**3,.5>a()?0:.5*a()**3);if(5==b.shape||.1>a())b.shapeCurve=10*a()**2;10<=b.shapeCurve&&(b.shapeCurve|=0);.5>a()&&(b.modulation*=-1);const c=b.attack+b.sustain+b.release;.5>a()&&(b.pitchJump=1E3*a()**2*(.5>a()?-1:1)|0,b.pitchJumpTime=a()*c);.5>a()&&(b.repeatTime=a()*c);return b}BuildSound(a=1,b=.05,c=220,f=0,m=0,n=.1,l=0,v=1,p=0,w=0,q=0,x=0,r=0,y=0,t=0,A=0,g=0){return{volume:a,randomness:b,frequency:c,attack:f,
sustain:m,release:n,shape:l,shapeCurve:v,slide:p,deltaSlide:w,pitchJump:q,pitchJumpTime:x,repeatTime:r,noise:y,modulation:t,bitCrush:A,delay:g}}GetNote(a,b){return a*2**(b/12)}SoundToArray(a){const b=this.BuildSound(),c=[];for(const f in b)c.push(a[f]);return c}CreateAudioContext(){const a=new (window.AudioContext||webkitAudioContext);a.a=a.createBufferSource;a.createBufferSource=(b=a.a())=>(b.start=b.start||(c=>a.noteOn(c)),b.stop=b.stop||(c=>a.noteOff(c)),b);return a}}const ZZFX=new _ZZFX;
function zzfx(){ZZFX.Play(...arguments)}